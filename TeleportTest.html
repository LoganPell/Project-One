<!DOCTYPE html>
<html>
<head>
	<title>Teleport Test</title>
<!-- jquery library -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!-- firebase -->
	<script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>
	<style>
       #map {
        height: 400px;
        width: 100%;
       }
    </style>
</head>
<body>
<div id="map"></div>
	<script>
	// Initialize Firebase
  	var config = {
    	apiKey: "AIzaSyBQRt4CNGQ8gYV01AuKqMSYBbxX1-F7QQ0",
    	authDomain: "project-1-143e3.firebaseapp.com",
    	databaseURL: "https://project-1-143e3.firebaseio.com",
    	projectId: "project-1-143e3",
    	storageBucket: "project-1-143e3.appspot.com",
    	messagingSenderId: "113693372705"
  	};
  	firebase.initializeApp(config);

	// Create a variable to reference the database.
   	var database = firebase.database();

	// urban area query
    var uaList = ["aarhus", "adelaide", "albuquerque", "almaty", "amsterdam", "anchorage", "ankara", "asheville", "asuncion", "athens", "atlanta", "auckland", "austin", "baku", "bali", "bangkok", "barcelona", "beijing", "beirut", "belfast", "belgrade", "belize-city", "bengaluru", "berlin", "bern", "birmingham","bogota", "boise", "bologna", "bordeaux", "boston", "boulder", "bozeman", "bratislava", "brisbane", "bristol", "brussels", "bucharest", "budapest", "buenos-aires", "buffalo", "cairo", "calgary", "cambridge", "cape-town", "caracas", "cardiff", "casablanca", "charleston", "charlotte", "chattanooga", "chennai", "chiang-mai", "chicago", "chisinau", "christchurch", "cincinnati", "cleveland", "cluj-napoca", "cologne", "colorado-springs", "columbus", "copenhagen", "cork", "curitiba", "dallas", "dar-es-salaam", "delhi", "denver", "des-moines", "detroit", "doha", "dresden", "dubai", "dublin", "dusseldorf", "edinburgh", "edmonton", "eindhoven", "eugene", "florence", "florianopolis", "fort-collins", "frankfurt", "fukuoka", "gdansk", "geneva", "glasgow", "gothenburg", "grenoble", "guadalajara", "guatemala-city", "halifax", "hamburg", "hannover", "havana", "helsinki", "ho-chi-minh-city", "hong-kong", "honolulu", "houston", "hyderabad", "indianapolis", "innsbruck", "istanbul", "jacksonville", "jakarta", "johannesburg", "kansas-city", "karlsruhe", "kathmandu", "kiev", "kingston", "knoxville", "krakow", "kuala-lumpur", "lagos", "la-paz", "las-palmas-de-gran-canaria", "las-vegas","lausanne", "leipzig", "lille", "lima", "lisbon", "liverpool", "ljubljana", "london", "los-angeles", "louisville", "luxembourg", "lviv", "lyon", "madison", "madrid", "malaga", "malmo", "managua", "manchester", "manila", "marseille", "medellin", "melbourne", "memphis", "mexico-city", "miami", "milan", "milwaukee", "minneapolis-saint-paul", "minsk", "montevideo", "montreal", "moscow", "mumbai", "munich", "nairobi", "nantes", "naples", "nashville", "new-orleans", "new-york", "nice", "nicosia", "oklahoma-city", "omaha", "orlando", "osaka", "oslo", "ottawa", "oulu", "oxford", "palo-alto", "panama", "paris", "perth", "philadelphia", "phnom-penh", "phoenix", "phuket", "pittsburgh", "portland-me", "portland-or", "porto", "porto-alegre", "prague", "providence", "quito", "raleigh", "reykjavik", "richmond", "riga", "rio-de-janeiro", "riyadh", "rochester", "rome", "rotterdam", "saint-petersburg", "salt-lake-city", "san-antonio", "san-diego", "san-francisco-bay-area", "san-jose", "san-juan", "san-luis-obispo", "san-salvador", "santiago", "santo-domingo", "sao-paulo", "sarajevo", "saskatoon", "seattle", "seoul", "seville", "shanghai", "singapore", "skopje", "sofia", "st-louis", "stockholm", "stuttgart", "sydney", "taipei", "tallinn", "tampa-bay-area", "tampere", "tartu", "tashkent", "tbilisi", "tehran", "tel-aviv", "the-hague", "thessaloniki", "tokyo", "toronto", "toulouse", "tunis", "turin", "turku", "uppsala", "utrecht", "valencia", "valletta", "vancouver", "victoria", "vienna", "vilnius", "warsaw", "washington-dc", "wellington", "winnipeg", "wroclaw", "yerevan", "zagreb", "zurich"];


	// urban area scores
	for (var i = 0; i < uaList.length; i++) {

		var scoreURL = "https://api.teleport.org/api/urban_areas/slug:" + uaList[i] + "/scores/";
			
		$.ajax({
			url: scoreURL,
			method: "GET"
		}).done(function(response) {
			// console.log(response);
			});
	}
	
	// urban area location
	for (var i = 0; i < uaList.length; i++) {

		var locationURL = "https://api.teleport.org/api/urban_areas/slug:" + uaList[i] + "/";
			
		$.ajax({
		url: locationURL,
		method: "GET"
		}).done(function(response) {
	  		locs.push({lat: response.bounding_box.latlon.north, lng: response.bounding_box.latlon.west});
	  		if (locs.length == 254) {
	  			console.log("locations" + JSON.stringify(locs));
	  			var locations = locs;
	  			initMap();
	  		}
		}); 	
	}
	
	function initMap() {

        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 3,
          center: {lat: -28.024, lng: 140.887}
        });

        // Create an array of alphabetical characters used to label the markers.
        var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

        // Add some markers to the map.
        // Note: The code uses the JavaScript Array.prototype.map() method to
        // create an array of markers based on a given "locations" array.
        // The map() method here has nothing to do with the Google Maps API.
        var markers = locs.map(function(location, i) {
          return new google.maps.Marker({
            position: location,
            label: labels[i % labels.length]
          });
        });

        // Add a marker clusterer to manage the markers.
        var markerCluster = new MarkerClusterer(map, markers,
            {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});
    }

    var locs = [];
</script>

<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
</script>
<script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBQRt4CNGQ8gYV01AuKqMSYBbxX1-F7QQ0&callback=initMap">
</script>
</body>
</html>
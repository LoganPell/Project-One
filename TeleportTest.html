<!DOCTYPE html>
<html>
<head>
	<title>Teleport Test</title>
<!-- jquery library -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!-- firebase -->
	<script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>
	<style>
    	#map {
        	height: 400px;
        	width: 100%;
    	}
/*  		#sortable { list-style-type: none; margin: 0; padding: 0; width: 60%; }
  		#sortable li { margin: 0 3px 3px 3px; padding: 0.4em; padding-left: 1.5em; font-size: 1.4em; height: 18px; }
  		#sortable li span { position: absolute; margin-left: -1.3em; }*/
    </style>
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script> 
<!-- 	<script>
  		var sortFunction = $( function() {
    		var sort = $("#sortable").sortable();
    		var sort1 = $("#sortable").disableSelection();
  		});
  	</script>  -->
</head>
<body>
<!-- input options -->
<h3>Housing</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<h3>Cost of Living</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<h3>Startups</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<h3>Venture Capital</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<h3>Travel Connectivity</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<h3>Commute</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<h3>Business Freedom</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<h3>Safety</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<h3>Healthcare</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<h3>Education</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<h3>Environmental Quality</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<h3>Economy</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<h3>Taxation</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<h3>Internet Access</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<h3>Leisure and Culture</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<h3>Tolerance</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<h3>Outdoors</h3>
<select>
    <option value="0.5">Not Important</option>
    <option value="1">Important</option>
    <option value="1.5">Very Important</option>
</select>

<button id="submit">submit</button>

<div id="top10display"></div>

<div id="map"></div>

<script>

var categories = ["Housing", "Cost of Living", "Startups", "Venture Capital", "Travel Conectivity", "Commute", "Business Freedom", "Safety", "Healthcare", "Education", "Environmental Quality", "Economy", "Taxation", "Internet Access", "Leixure & Culture", "Tolerance", "Outdors"];
   	var values = [];

	var citiesScored = [];
	var citiesToDisplay = [];
	var cityScoreAccumulated = 0;
	var cityName = "";
	var totalScore = 0;
	var cityBeenScored = {};
	var m=0;
 	var displayCity = "";
   	var locs = [];
	// urban area query
    var uaList = ["aarhus", "adelaide", "albuquerque", "almaty", "amsterdam", "anchorage", "ankara", "asheville", "asuncion", "athens", "atlanta", "auckland", "austin", "baku", "bali", "bangkok", "barcelona", "beijing", "beirut", "belfast", "belgrade", "belize-city", "bengaluru", "berlin", "bern", "birmingham","bogota", "boise", "bologna", "bordeaux", "boston", "boulder", "bozeman", "bratislava", "brisbane", "bristol", "brussels", "bucharest", "budapest", "buenos-aires", "buffalo", "cairo", "calgary", "cambridge", "cape-town", "caracas", "cardiff", "casablanca", "charleston", "charlotte", "chattanooga", "chennai", "chiang-mai", "chicago", "chisinau", "christchurch", "cincinnati", "cleveland", "cluj-napoca", "cologne", "colorado-springs", "columbus", "copenhagen", "cork", "curitiba", "dallas", "dar-es-salaam", "delhi", "denver", "des-moines", "detroit", "doha", "dresden", "dubai", "dublin", "dusseldorf", "edinburgh", "edmonton", "eindhoven", "eugene", "florence", "florianopolis", "fort-collins", "frankfurt", "fukuoka", "gdansk", "geneva", "glasgow", "gothenburg", "grenoble", "guadalajara", "guatemala-city", "halifax", "hamburg", "hannover", "havana", "helsinki", "ho-chi-minh-city", "hong-kong", "honolulu", "houston", "hyderabad", "indianapolis", "innsbruck", "istanbul", "jacksonville", "jakarta", "johannesburg", "kansas-city", "karlsruhe", "kathmandu", "kiev", "kingston", "knoxville", "krakow", "kuala-lumpur", "lagos", "la-paz", "las-palmas-de-gran-canaria", "las-vegas","lausanne", "leipzig", "lille", "lima", "lisbon", "liverpool", "ljubljana", "london", "los-angeles", "louisville", "luxembourg", "lviv", "lyon", "madison", "madrid", "malaga", "malmo", "managua", "manchester", "manila", "marseille", "medellin", "melbourne", "memphis", "mexico-city", "miami", "milan", "milwaukee", "minneapolis-saint-paul", "minsk", "montevideo", "montreal", "moscow", "mumbai", "munich", "nairobi", "nantes", "naples", "nashville", "new-orleans", "new-york", "nice", "nicosia", "oklahoma-city", "omaha", "orlando", "osaka", "oslo", "ottawa", "oulu", "oxford", "palo-alto", "panama", "paris", "perth", "philadelphia", "phnom-penh", "phoenix", "phuket", "pittsburgh", "portland-me", "portland-or", "porto", "porto-alegre", "prague", "providence", "quito", "raleigh", "reykjavik", "richmond", "riga", "rio-de-janeiro", "riyadh", "rochester", "rome", "rotterdam", "saint-petersburg", "salt-lake-city", "san-antonio", "san-diego", "san-francisco-bay-area", "san-jose", "san-juan", "san-luis-obispo", "san-salvador", "santiago", "santo-domingo", "sao-paulo", "sarajevo", "saskatoon", "seattle", "seoul", "seville", "shanghai", "singapore", "skopje", "sofia", "st-louis", "stockholm", "stuttgart", "sydney", "taipei", "tallinn", "tampa-bay-area", "tampere", "tartu", "tashkent", "tbilisi", "tehran", "tel-aviv", "the-hague", "thessaloniki", "tokyo", "toronto", "toulouse", "tunis", "turin", "turku", "uppsala", "utrecht", "valencia", "valletta", "vancouver", "victoria", "vienna", "vilnius", "warsaw", "washington-dc", "wellington", "winnipeg", "wroclaw", "yerevan", "zagreb", "zurich"];

    //storing values
    $("#submit").on("click", function() {
        m = 0;
        locs = [];        
        citiesScored = [];
        citiesToDisplay = [];
        citiesBeenScored = [];    
        values = [];
         $("#top10display").empty();
        $("select option:selected").each(function () {
            var selected = $(this).val();
            values.push(selected);
        });
        console.log(values);
    	
    	// urban area scores
		for (var i = 0; i < uaList.length; i++) {
		// for (var i = 0; i < 5; i++) {
			var scoreURL = "https://api.teleport.org/api/urban_areas/slug:" + uaList[i] + "/scores/";
			
			$.ajax({
				url: scoreURL,
				method: "GET"
			}).done(function(response) {
				// console.log(response);
				var results = response.categories;
				var score = 0;
				cityScoreAccumulated = 0;
				// console.log(results);
				var summary = response.summary;
				// console.log(summary);
			
				for (var j = 0; j < 17; j++) {
					score = response.categories[j].score_out_of_10;
					cityScoreAccumulated = cityScoreAccumulated + (score * values[j]);
				}// Enf For-Loop
				arrayScoredCities();
			});// End .done()
	}// Enf For-Loop to access the scores of urban areas
});

//Function to array the cities from best option to worst option
function arrayScoredCities() {
    var cityName = uaList[m];
    var totalScore = cityScoreAccumulated;
    var cityBeenScored = {
        city: cityName,
        score: totalScore
    };
    citiesScored.push(cityBeenScored);
    organizeCities();
    m++;
    if (m === 254) {
        cityLocation();
    }
}; //End of arrayScoredCities

console.log("Sorted: " , citiesScored);

// Sorting of the array with JS .sort
function organizeCities() {
    citiesScored.sort(function(a, b){return b.score - a.score});
    // console.log("Sorted Array: ", citiesScored);
}

// urban a location
function cityLocation() {
	for (var k = 0; k < 10 ; k++) {
	    var locationURL = "https://api.teleport.org/api/urban_areas/slug:" + citiesScored[k].city + "/";		

	    	$.ajax({
				url: locationURL,
				method: "GET"
			}).done(function(response) {
			//console.log(response);

			var latitude = (response.bounding_box.latlon.north + response.bounding_box.latlon.south)/2;
			var longitude = (response.bounding_box.latlon.west + response.bounding_box.latlon.east)/2;
	  		locs.push({lat: latitude, lng: longitude});
	  			if (locs.length == 10) {
	  			// console.log("locations" + JSON.stringify(locs));
	  			displayTenTopCities();
	  			initMap();
	  			} // End of "if (locs.length"
			}); // End of .done  	
  	} // End of for-loop k
} //End of cityLocation

//Function to display the top 10 cities before the map
function displayTenTopCities() {
    for (l = 0; l<10; l++) {
        var res = String.fromCharCode(65+l);
        displayCity = (res+". "+citiesScored[l].city + " " + (citiesScored[l].score).toFixed(5)+",   ");
        console.log(displayCity);
       
        $("#top10display").append(displayCity);
    }
}

//Function to display the cities in the map
function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 2,
        center: {lat: 0.000, lng: 90.000}
    }); // End var map

    // Create an array of alphabetical characters used to label the markers.
    var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

    // Add some markers to the map.
    // Note: The code uses the JavaScript Array.prototype.map() method to
    // create an array of markers based on a given "locations" array.
    // The map() method here has nothing to do with the Google Maps API.
    var markers = locs.map(function(location, i) {
        return new google.maps.Marker({
            position: location,
            label: labels[i % labels.length]
        }); //End return new
    }); // End var markers

    // Add a marker clusterer to manage the markers.
    var markerCluster = new MarkerClusterer(map, markers, {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});
} // End of initMap()
</script>

<!-- google api -->
<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
</script>

<!-- render map -->
<script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBQRt4CNGQ8gYV01AuKqMSYBbxX1-F7QQ0&callback=initMap">
</script>
</body>
</html>